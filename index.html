<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>MindLinker</title>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

  <style>
    body { font-family: sans-serif; padding: 20px; }
    .card { border: 1px solid #ccc; margin: 10px 0; padding: 10px; border-radius: 8px; }
    #hint { display: none; font-style: italic; color: gray; }
  </style>
</head>
<body>
  <h1>ğŸ§  MindLinker</h1>
  <p id="wordPair">ë‹¨ì–´ìŒ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
  <button onclick="toggleHint()">ğŸ” íŒíŠ¸ ë³´ê¸°</button>
  <p id="hint"></p>

  <textarea id="userAnswer" rows="5" cols="50" placeholder="ë‹¹ì‹ ì˜ ìƒê°ì„ ì ì–´ë³´ì„¸ìš”"></textarea><br>
  <button onclick="submitAnswer()">ì œì¶œí•˜ê¸°</button>

  <h2>ğŸ’¬ ë‹¤ë¥¸ ì‚¬ëŒë“¤ì˜ ìƒê°</h2>
  <div id="answerList"></div>

  <script>
    // âœ… Firebase êµ¬ì„± ì •ë³´
    const firebaseConfig = {
      apiKey: "AIzaSyDoWfAhh1VmfYnokSZs9enq8s1liRL5t0",
      authDomain: "kmindlinker.firebaseapp.com",
      projectId: "kmindlinker",
      storageBucket: "kmindlinker.appspot.com",
      messagingSenderId: "544037002770",
      appId: "1:544037002770:web:a374f6c4a94bece58b82cb",
      measurementId: "G-Q3N5L45VD3"
    };

    const app = firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    let currentWordPair = "";
    let currentHint = "";

    // ğŸ“… ì˜¤ëŠ˜ì˜ ë‹¨ì–´ìŒ ë¶ˆëŸ¬ì˜¤ê¸°
    fetch('./data/Daily_data.json')
      .then(res => res.json())
      .then(data => {
        const today = new Date().toISOString().slice(0, 10);
        const entry = data.find(d => d.Date === today);
        if (entry) {
          currentWordPair = `${entry["Concept A"]} vs ${entry["Concept B"]}`;
          currentHint = entry["Hint/Description"];
          document.getElementById('wordPair').innerHTML = `<strong>${currentWordPair}</strong>`;
        } else {
          document.getElementById('wordPair').textContent = "âŒ ì˜¤ëŠ˜ì˜ ë‹¨ì–´ìŒì´ ì—†ìŠµë‹ˆë‹¤.";
        }
      });

    function toggleHint() {
      const hintEl = document.getElementById('hint');
      if (hintEl.style.display === 'none') {
        hintEl.style.display = 'block';
        hintEl.textContent = currentHint;
      } else {
        hintEl.style.display = 'none';
      }
    }

    // ğŸ“ ë‹µë³€ ì œì¶œ
    function submitAnswer() {
      const text = document.getElementById('userAnswer').value.trim();
      if (!text) return alert("ë‹µë³€ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");

      db.collection("answers").add({
        text,
        wordPair: currentWordPair,
        timestamp: new Date().toISOString()
      }).then(() => {
        document.getElementById('userAnswer').value = '';
        loadAnswers();
      });
    }

    // ğŸ“¥ ë‹µë³€ ë¶ˆëŸ¬ì˜¤ê¸°
    function loadAnswers() {
      const container = document.getElementById('answerList');
      container.innerHTML = '';
      db.collection("answers")
        .orderBy("timestamp", "desc")
        .get()
        .then(snapshot => {
          snapshot.forEach(doc => {
            const data = doc.data();
            const div = document.createElement('div');
            div.className = 'card';
            div.innerHTML = `<strong>${data.wordPair}</strong><br>${data.text}<br><small>${data.timestamp}</small>`;
            container.appendChild(div);
          });
        });
    }

    // ì²« ë¡œë”© ì‹œ ìë™ í˜¸ì¶œ
    window.onload = loadAnswers;
  </script>
</body>
</html>
